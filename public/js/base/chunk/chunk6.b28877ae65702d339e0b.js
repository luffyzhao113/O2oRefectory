webpackJsonp([6],{"+uRU":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l(n("/sfj")),o=l(n("3A9z")),r=l(n("Am3z")),i=l(n("dOo4")),s=l(n("fl/H"));function l(t){return t&&t.__esModule?t:{default:t}}e.default={name:"create",components:{Box:s.default,ComponentModal:a.default},mixins:[r.default,o.default,i.default],data:function(){return{formCreate:{name:"",status:1,description:""},permissions:[]}},computed:{treePermissions:function(){var t=[];return JSON.parse(JSON.stringify(this.permissions)).forEach(function(e){t.push({id:e.id,parent_id:e.parent_id,title:e.title,expand:!0})}),this.toTree(t)},checkedPermissions:function(){return this.toChecked(JSON.parse(JSON.stringify(this.treePermissions)))}},mounted:function(){var t=this;this.loading=!0,this.$http.get("role/create").then(function(e){t.permissions=e.data.data}).catch(function(e){t.formatErrors(e)}).finally(function(){t.loading=!1})},methods:{createSubmit:function(t,e){var n=this;this.$refs[t].validate(function(a){if(a){n.loading=!0;var o=Object.assign({},n._data[t],{permissions:n.checkedPermissions});n.$http.post(e,o).then(function(t){n.$Message.success("Success!"),n.change(!1)}).catch(function(t){n.formatErrors(t)}).finally(function(){n.loading=!1})}})},toChecked:function(t){var e=this,n=[];return t.forEach(function(t){!0!==t.indeterminate&&!0!==t.checked||(n.push(t.id),t.children&&t.children.length>0&&(n=n.concat(e.toChecked(t.children))))}),n}}}},"/sfj":function(t,e,n){var a=n("VU/8")(n("hPTO"),n("mbik"),!1,function(t){n("yheb")},"data-v-117bdab6",null);t.exports=a.exports},"0jOw":function(t,e,n){var a=n("VU/8")(n("A5/f"),n("Wkdi"),!1,function(t){n("lsTo")},null,null);t.exports=a.exports},"14zQ":function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,".box-flex-list{position:relative}.box-flex-list .ivu-card-head .right{float:right}.box-flex-list .ivu-card-head .title{height:24px;line-height:24px}.box-flex-list .ivu-table .table-info-row td{background-color:#2db7f5;color:#fff}.box-flex-list .ivu-page{text-align:right}.box-flex-list .ivu-table-wrapper{margin-bottom:15px}",""])},"17ba":function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,"",""])},"1ihv":function(t,e,n){var a=n("VU/8")(n("+uRU"),n("Jy8U"),!1,function(t){n("aK2g")},"data-v-f1e94a26",null);t.exports=a.exports},"3A9z":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{componentProps:{}},data:function(){return{loading:!1}},methods:{change:function(t){!1===t&&this.$emit("on-change")}}}},"78L4":function(t,e,n){var a=n("VU/8")(n("C3bg"),n("LtSO"),!1,function(t){n("8l5G")},"data-v-0f62af55",null);t.exports=a.exports},"8hQC":function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,".box[data-v-70c17452]{margin-bottom:10px;border:1px solid #dddee1;border-radius:5px}.box[data-v-70c17452]:last-child{margin-bottom:0}.box-header[data-v-70c17452]{padding:8px 48px 8px 16px;color:#495060;font-size:12px;line-height:16px;border-bottom:1px solid #dddee1}.box-detail[data-v-70c17452]{padding:10px}",""])},"8l5G":function(t,e,n){var a=n("Mfgk");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("6add217a",a,!0,{})},"A5/f":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"my-lists",props:{value:{type:Object,default:function(){return{data:[],page:{total:100,current:1,page_size:20}}}},columns:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1}},data:function(){return{leftCol:[{title:"序号",render:function(t,e){var n=e.index;return t("span",null,[++n])},width:75}],rightCol:[]}},computed:{tableCol:function(){return this.leftCol.concat(this.columns,this.rightCol)}},methods:{change:function(t){this.$emit("change",t)},rowClassName:function(t,e){}}}},Am3z:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,o=n("y6l7"),r=(a=o)&&a.__esModule?a:{default:a};e.default={mixins:[r.default],methods:{updateSubmit:function(t,e){var n=this;this.$refs[t].validate(function(a){a?(n.loading=!0,n.$http.put(e,n.unObserver(n._data[t])).then(function(t){n.$Message.success("Success!"),n.change(!1)}).catch(function(t){n.formatErrors(t)}).finally(function(){n.loading=!1})):n.$Message.error("验证不通过!")})},createSubmit:function(t,e){var n=this;this.$refs[t].validate(function(a){a&&(n.loading=!0,n.$http.post(e,n._data[t]).then(function(t){n.$Message.success("Success!"),n.change(!1)}).catch(function(t){n.formatErrors(t)}).finally(function(){n.loading=!1}))})}}}},C3bg:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s(n("0jOw")),o=s(n("VWqC")),r=s(n("1ihv")),i=s(n("PCsR"));function s(t){return t&&t.__esModule?t:{default:t}}e.default={components:{MyLists:a.default,Create:r.default,Update:i.default},mixins:[o.default],name:"index",data:function(){var t=this;return{columns:[{title:"角色名称",key:"name"},{title:"用户数量",key:"users_count"},{title:"操作",render:function(e,n){var a=n.row;return e("div",null,[e("i-button",{attrs:{size:"small"},on:{click:function(){return t.showComponent("Update",a)}}},["修改"]),e("poptip",{attrs:{confirm:!0,transfer:!0,title:"确定要删除吗？"},on:{"on-ok":function(){return t.destroyItem(a,"role/"+a.id)}}},[e("i-button",{attrs:{size:"small"}},["删除"])])])}}]}},methods:{search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.loading=!0,this.$http.get("role",{params:this.request(e)}).then(function(e){t.assignmentData(e.data.data)}).catch(function(e){t.formatError(e)}).finally(function(){t.loading=!1})}}}},Jy8U:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("component-modal",{attrs:{title:"创建角色",loading:t.loading,width:700}},[n("Form",{ref:"formCreate",attrs:{model:t.formCreate,"label-width":80}},[n("box",{attrs:{title:"角色管理"}},[n("FormItem",{attrs:{label:"角色名称",prop:"name",rules:{required:!0,message:"角色名称不能为空"}}},[n("Input",{attrs:{placeholder:"角色名称"},model:{value:t.formCreate.name,callback:function(e){t.$set(t.formCreate,"name",e)},expression:"formCreate.name"}})],1),t._v(" "),n("FormItem",{attrs:{label:"是否开启",prop:"status"}},[n("RadioGroup",{attrs:{type:"button"},model:{value:t.formCreate.status,callback:function(e){t.$set(t.formCreate,"status",e)},expression:"formCreate.status"}},[n("Radio",{attrs:{label:1,value:1}},[t._v("开启")]),t._v(" "),n("Radio",{attrs:{label:0,value:0}},[t._v("关闭")])],1)],1),t._v(" "),n("FormItem",{attrs:{label:"角色描述",prop:"description"}},[n("Input",{attrs:{type:"textarea",placeholder:"角色描述"},model:{value:t.formCreate.description,callback:function(e){t.$set(t.formCreate,"description",e)},expression:"formCreate.description"}})],1)],1),t._v(" "),n("box",{attrs:{title:"权限管理"}},[n("tree",{attrs:{data:t.treePermissions,"show-checkbox":""}})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{on:{click:function(e){t.createSubmit("formCreate","role")}}},[t._v("创建")])],1)],1)},staticRenderFns:[]}},LTAw:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,".modal-body[data-v-117bdab6]{max-height:500px;overflow-y:auto}",""])},LtSO:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("my-lists",{attrs:{columns:t.columns,loading:t.loading},on:{change:t.search},model:{value:t.data,callback:function(e){t.data=e},expression:"data"}},[n("Card",[n("p",{attrs:{slot:"title"},slot:"title"},[n("span",[t._v("搜索")])]),t._v(" "),n("Form",{ref:"searchForm",attrs:{model:t.searchForm,inline:""}},[n("FormItem",{attrs:{prop:"name",label:"角色名称","label-width":60}},[n("Input",{attrs:{type:"text"},model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name",e)},expression:"searchForm.name"}})],1),t._v(" "),n("FormItem",{attrs:{"label-width":1}},[n("Button",{attrs:{type:"primary"},on:{click:function(e){t.search(1)}}},[t._v("搜索")]),t._v(" "),n("Button",{attrs:{type:"warning"},on:{click:function(e){t.showComponent("Create")}}},[t._v("添加")])],1)],1)],1),t._v(" "),n(t.component.current,{tag:"components",attrs:{componentProps:t.component.data},on:{"on-change":t.hideComponent}})],1)},staticRenderFns:[]}},Mfgk:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,"",""])},PCsR:function(t,e,n){var a=n("VU/8")(n("sUaR"),n("YEO5"),!1,function(t){n("oBA8")},"data-v-52bcb32c",null);t.exports=a.exports},PmXP:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"box",props:{title:{type:String,default:"标题"}}}},VWqC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(n("y6l7")),o=r(n("dgho"));function r(t){return t&&t.__esModule?t:{default:t}}e.default={mixins:[a.default,o.default],data:function(){return{searchForm:{},data:{data:[],page:{total:0,current:1,page_size:20}}}},mounted:function(){var t=this;this.$nextTick(function(){t.search()})},methods:{search:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]},assignmentData:function(t){this.data.data=t.data,this.data.page.total=t.total,this.data.page.current=t.current_page,this.data.page.page_size=t.per_page},destroyItem:function(t,e){var n=this;this.$http.delete(e).then(function(t){n.search()}).catch(function(t){n.formatErrors(t)})},request:function(t){var e=JSON.parse(JSON.stringify(this.searchForm));return e.page=t,e}}}},Wkdi:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._t("default"),t._v(" "),n("div",{staticClass:"box-flex-list"},[n("Card",{attrs:{"dis-hover":""}},[n("div",{attrs:{slot:"title"},slot:"title"},[t._t("title",[n("span",[t._v("列表")])]),t._v(" "),n("div",{staticClass:"right"},[t._t("button")],2)],2),t._v(" "),n("Table",{ref:"table",attrs:{columns:t.tableCol,data:t.value.data,size:"small","row-class-name":t.rowClassName,loading:t.loading}}),t._v(" "),n("Page",{attrs:{total:t.value.page.total,size:"small",current:t.value.page.current,"page-size":t.value.page.page_size,"show-total":""},on:{"on-change":t.change}})],1)],1)],2)},staticRenderFns:[]}},YEO5:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("component-modal",{attrs:{title:"修改角色",loading:t.loading,width:700}},[n("Form",{ref:"formUpdate",attrs:{model:t.formUpdate,"label-width":80}},[n("box",{attrs:{title:"角色管理"}},[n("FormItem",{attrs:{label:"角色名称",prop:"name",rules:{required:!0,message:"角色名称不能为空"}}},[n("Input",{attrs:{placeholder:"角色名称"},model:{value:t.formUpdate.name,callback:function(e){t.$set(t.formUpdate,"name",e)},expression:"formUpdate.name"}})],1),t._v(" "),n("FormItem",{attrs:{label:"是否开启",prop:"status"}},[n("RadioGroup",{attrs:{type:"button"},model:{value:t.formUpdate.status,callback:function(e){t.$set(t.formUpdate,"status",e)},expression:"formUpdate.status"}},[n("Radio",{attrs:{label:1,value:1}},[t._v("开启")]),t._v(" "),n("Radio",{attrs:{label:0,value:0}},[t._v("关闭")])],1)],1),t._v(" "),n("FormItem",{attrs:{label:"角色描述",prop:"description"}},[n("Input",{attrs:{type:"textarea",placeholder:"角色描述"},model:{value:t.formUpdate.description,callback:function(e){t.$set(t.formUpdate,"description",e)},expression:"formUpdate.description"}})],1)],1),t._v(" "),n("box",{attrs:{title:"权限管理"}},[n("tree",{attrs:{data:t.treePermissions,"show-checkbox":""}})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{on:{click:function(e){t.updateSubmit("formUpdate","role/"+t.componentProps.id)}}},[t._v("更新")])],1)],1)},staticRenderFns:[]}},aK2g:function(t,e,n){var a=n("17ba");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("696139bc",a,!0,{})},dgho:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{component:{current:"",data:{}}}},methods:{showComponent:function(t,e){this.component.current=t,this.component.data=e},hideComponent:function(){this.component.current="",this.component.data={},this.search()}}}},e7oK:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,"",""])},"fl/H":function(t,e,n){var a=n("VU/8")(n("PmXP"),n("lQ1j"),!1,function(t){n("rhAQ")},"data-v-70c17452",null);t.exports=a.exports},hPTO:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"component-modal",props:{title:{type:String,default:"弹窗"},width:{type:Number,default:520},loading:{type:Boolean,default:!1}},methods:{change:function(t){this.$parent.$emit("on-change")}}}},lQ1j:function(t,e){t.exports={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"box"},[e("div",{staticClass:"box-header"},[this._v(this._s(this.title))]),this._v(" "),e("Row",{staticClass:"box-detail"},[this._t("default")],2)],1)},staticRenderFns:[]}},lsTo:function(t,e,n){var a=n("14zQ");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("6516009c",a,!0,{})},mbik:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{attrs:{title:t.title,value:!0,transfer:!1,"mask-closable":!1,width:t.width},on:{"on-visible-change":t.change}},[n("div",{staticClass:"modal-body"},[t._t("default")],2),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[t._t("footer")],2),t._v(" "),t.loading?n("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},staticRenderFns:[]}},oBA8:function(t,e,n){var a=n("e7oK");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("13304fac",a,!0,{})},rhAQ:function(t,e,n){var a=n("8hQC");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("642918c8",a,!0,{})},sUaR:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l(n("/sfj")),o=l(n("3A9z")),r=l(n("Am3z")),i=l(n("fl/H")),s=l(n("dOo4"));function l(t){return t&&t.__esModule?t:{default:t}}e.default={name:"update",components:{Box:i.default,ComponentModal:a.default},mixins:[r.default,o.default,s.default],data:function(){return{formUpdate:{name:"",status:1,description:""},permissions:[]}},computed:{treePermissions:function(){var t=this,e=[];return JSON.parse(JSON.stringify(this.permissions)).forEach(function(n){e.push({id:n.id,parent_id:n.parent_id,title:n.title,expand:!0,indeterminate:t.indeterminate(n),checked:t.checked(n)})}),this.toTree(e)},checkedPermissions:function(){return this.toChecked(JSON.parse(JSON.stringify(this.treePermissions)))}},mounted:function(){var t=this;this.loading=!0,this.$http.get("role/"+this.componentProps.id+"/edit").then(function(e){t.formUpdate=e.data.data.row,t.permissions=e.data.data.permissions}).catch(function(e){t.formatErrors(e)}).finally(function(){t.loading=!1})},methods:{updateSubmit:function(t,e){var n=this;this.$refs[t].validate(function(a){if(a){n.loading=!0;var o=Object.assign({},n._data[t],{permissions:n.checkedPermissions});n.$http.put(e,o).then(function(t){n.$Message.success("Success!"),n.change(!1)}).catch(function(t){n.formatErrors(t)}).finally(function(){n.loading=!1})}else n.$Message.error("验证不通过!")})},child:function(t){return this.permissions.filter(function(e){return e.parent_id==t})},indeterminate:function(t){return this.child(t.id).length>0&&!(void 0===this.formUpdate.perms.find(function(e){return e.id===t.id}))},checked:function(t){return!(this.child(t.id).length>0)&&!(void 0===this.formUpdate.perms.find(function(e){return e.id===t.id}))},toChecked:function(t){var e=this,n=[];return t.forEach(function(t){!0!==t.indeterminate&&!0!==t.checked||(n.push(t.id),t.children&&t.children.length>0&&(n=n.concat(e.toChecked(t.children))))}),n}}}},yheb:function(t,e,n){var a=n("LTAw");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n("rjj0")("bf9a99e2",a,!0,{})}});